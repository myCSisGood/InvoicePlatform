{% extends "Mainpage.html" %}

{% block main %}
<body class="bg-gray-50 h-screen">
    <div class="container mx-auto py-6">
        
        {% comment %}
        <div class="mb-4">
            <label for="county" class="block text-sm font-medium text-gray-600">選擇縣市</label>
            <select id="county" name="county" class="mt-1 block w-full py-1 px-2 border border-gray-300 bg-white rounded shadow-sm focus:outline-none focus:ring-blue-400 focus:border-blue-400 sm:text-sm">
                <option value="">請選擇縣市</option>
                <option value="Taipei">台北市</option>
                <option value="New Taipei">新北市</option>
                <option value="Taoyuan">桃園市</option>
                <option value="Taichung">台中市</option>
                <option value="Tainan">台南市</option>
                <option value="Kaohsiung">高雄市</option>
            </select>
        </div>
        {% endcomment %}
       
        <div class="bg-white p-4 rounded shadow mb-4">
            {{ title }}
            <canvas id="barChart" class="w-full h-48"></canvas>
        </div>

       
        <div class="text-right">
            <button id="viewTableButton" class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 focus:outline-none">
                see all
            </button>
        </div>
        
        {% if data %}
        <!-- Data Table -->
        <div id="dataTable" class="mt-4 bg-white p-4 rounded shadow hidden">
            <h5 class="text-sm font-medium text-gray-700 mb-3">完整資料表</h5>
            <div class="overflow-x-auto">
                <table class="min-w-full bg-white border border-gray-300 text-sm">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="px-2 py-1 border-b text-left">Store Name</th>
                            <th class="px-2 py-1 border-b text-left">Total Quantity</th>
                            <th class="px-2 py-1 border-b text-left">Total Profit</th>
                            <th class="px-2 py-1 border-b text-left">Profit Per Unit</th>
                            <th class="px-2 py-1 border-b text-left">Number of Sales Records</th>
                            <th class="px-2 py-1 border-b text-left">Profit Per Sales</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for store_name, total_quantity, total_profit, profit_per_unit, number_of_salesrecord, profit_per_sales in data %}
                        <tr class="hover:bg-gray-50">
                            <td class="px-2 py-1 border-b">{{ store_name }}</td>
                            <td class="px-2 py-1 border-b">{{ total_quantity }}</td>
                            <td class="px-2 py-1 border-b">{{ total_profit }}</td>
                            <td class="px-2 py-1 border-b">{{ profit_per_unit|floatformat:2 }}</td>
                            <td class="px-2 py-1 border-b">{{ number_of_salesrecord }}</td>
                            <td class="px-2 py-1 border-b">{{ profit_per_sales|floatformat:2 }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% else %}
        <p class="mt-4 text-center text-gray-500 text-sm">No Data Available</p>
        {% endif %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        const labels = {{ top_10_stores|safe }};
        const data = {
            labels: labels,
            datasets: [{
                label: 'Total Quantity',
                data: {{ top_10_quantities|safe }},
                backgroundColor: 'rgba(54, 162, 235, 0.6)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1,
            }]
        };

        const config = {
            type: 'bar',
            data: data,
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(200, 200, 200, 0.3)'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false,
                    }
                }
            }
        };

        
        const barChart = new Chart(
            document.getElementById('barChart'),
            config
        );

        document.getElementById('viewTableButton').addEventListener('click', function() {
            const dataTable = document.getElementById('dataTable');
            dataTable.classList.toggle('hidden');
        });
    </script>
</body>
{% endblock %}
