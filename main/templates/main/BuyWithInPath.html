{% extends "Mainpage.html" %}

{% block main %}
<body class="bg-gray-50 h-screen">
    <div class="container mx-auto py-4 h-full flex flex-col">
        
        <div class="flex items-center mb-4">
            <h2 class="text-xl font-semibold text-gray-800 mr-2">Show with {{ displayType }}</h2>
            <button id="infoButton" class="ml-2 p-1 rounded-full text-blue-500 hover:text-blue-700 bg-white shadow hover:bg-gray-100">
                <ion-icon name="help-circle-outline" size="medium"></ion-icon>
            </button>
        </div>

        
        <div id="infoModal" class="fixed z-50 inset-0 hidden overflow-y-auto">
            <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
                <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                    <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
                </div>
                <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
                <div class="inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6">
                    <div class="absolute top-0 right-0 pt-4 pr-4">
                        <button id="closeModal" class="bg-white rounded-md text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            <span class="sr-only">Close</span>
                            <ion-icon name="close-outline" size="medium"></ion-icon>
                        </button>
                    </div>
                    <div id="infoContent" class="mt-3 text-center sm:mt-5">
                        Loading...
                    </div>
                </div>
            </div>
        </div>
<!-- Main Display (Left Content) -->
<div class="lg:col-span-2 p-4 rounded-lg shadow-lg border border-gray-200 bg-white relative h-full flex flex-col" style="height: 70vh;"> <!-- Set height to 70vh -->
    <div class="flex justify-center flex-grow overflow-auto">
        <!-- Adjust the iframe height to fit the new section size -->
        <iframe id="picture" class="w-full h-full border-none"></iframe> 
    </div>

    <div class="absolute bottom-4 right-4 flex space-x-2">
        <a href="{% url 'main:saveData' %}" class="px-3 py-1 bg-green-500 text-white text-sm font-medium rounded-md shadow-sm hover:bg-green-600 transition duration-200 flex items-center">
            <ion-icon name="save-outline" class="mr-1"></ion-icon>Save
        </a>
    </div>
</div>

<!-- Action Buttons for Different Display Types -->
<div class="flex justify-between mt-2"> <!-- Adjust margin-top slightly -->
    <button id="showRegular" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 flex items-center text-sm">
        Show with Regular
    </button>
    <button id="showArticulation" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 flex items-center text-sm">
        Show with Articulation Points
    </button>
    <button id="showCommunity" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 flex items-center text-sm">
        Show with Community
    </button>
</div>



    <!-- CSS for Date Picker -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/plugins/monthSelect/style.css">

    <!-- jQuery for AJAX Calls -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- JavaScript Logic -->
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Open modal with AJAX content
            $('#infoButton').click(function() {
                var displayType = "{{ displayType }}";
                $.ajax({
                    url: "{% url 'main:showInfo' %}",
                    data: { 'displayType': displayType },
                    success: function(data) {
                        $('#infoContent').html(data.content);
                        $('#infoModal').removeClass('hidden');
                    }
                });
            });

            // Close modal
            $('#closeModal').click(function() {
                $('#infoModal').addClass('hidden');
            });

            // Variables for different content types
            var relationship = `{% filter escapejs %}{{ relationship|safe }}{% endfilter %}`;
            var articulation = `{% filter escapejs %}{{ articulationPoint|safe }}{% endfilter %}`;
            var communities = `{% filter escapejs %}{{ communities|safe }}{% endfilter %}`;

            // Initial content load in iframe
            updateIframeContent(relationship);

            
            $('#showRegular').click(function() {
                updateIframeContent(relationship);
            });

            $('#showArticulation').click(function() {
                updateIframeContent(articulation);
            });

            $('#showCommunity').click(function() {
                updateIframeContent(communities);
            });

            // Function to update the content of the iframe
            function updateIframeContent(content) {
                const frame = document.getElementById('picture');
                frame.contentDocument.open();
                frame.contentDocument.write(content);
                frame.contentDocument.close();
            }
        });
    </script>
</body>
{% endblock %}
